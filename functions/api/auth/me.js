function o(e,n){if(!e)return null;let s=e.split(";");for(let r of s){let[t,i]=r.trim().split("=");if(t===n)return i}return null}var a=async e=>{let n=o(e.request.headers.get("Cookie"),"session");if(!n)return new Response(JSON.stringify({user:null}),{status:200,headers:{"Content-Type":"application/json"}});try{let s=await e.env.DB.prepare('SELECT * FROM sessions WHERE id = ? AND expires_at > datetime("now")').bind(n).first();if(!s)return new Response(JSON.stringify({user:null}),{status:200,headers:{"Content-Type":"application/json"}});let r=await e.env.DB.prepare("SELECT id, email, name, avatar_url, provider FROM users WHERE id = ?").bind(s.user_id).first();return new Response(JSON.stringify({user:r}),{status:200,headers:{"Content-Type":"application/json"}})}catch(s){return console.error("Auth check error:",s),new Response(JSON.stringify({user:null}),{status:200,headers:{"Content-Type":"application/json"}})}};export{a as onRequestGet};
